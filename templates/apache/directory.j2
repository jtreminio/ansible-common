{% for directory in vhost.sections|default([]) %}
  {% if directory.provider|default(false) == 'directorymatch' %}{% set provider = 'DirectoryMatch' %}
  {% elif directory.provider|default(false) == 'locationmatch' %}{% set provider = 'LocationMatch' %}
  {% elif directory.provider|default(false) == 'filesmatch' %}{% set provider = 'FilesMatch' %}
  {% elif directory.provider|default(false) == 'proxymatch' %}{% set provider = 'ProxyMatch' %}
  {% else %}{% set provider = (directory.provider|default('directory'))|capitalize %}{% endif %}

  {% if directory.allow|default(false) not in [false, 'false', ''] %}
  # WARNING: Using `allow` is deprecated in your Apache version
  {% endif %}
  {% if directory.deny|default(false) not in [false, 'false', ''] %}
  # WARNING: Using `deny` is deprecated in your Apache version
  {% endif %}
  {% if directory.order|default(false) not in [false, 'false', ''] %}
  # WARNING: Using `order` is deprecated in your Apache version
  {% endif %}
  {% if directory.satisfy|default(false) not in [false, 'false', ''] %}
  # WARNING: Using `satisfy` is deprecated in your Apache version
  {% endif %}
  {% if directory.path|default(false) %}
  <{{ provider}} "{{ directory.path }}">
    {% for header in directory.headers|default([]) %}
    Header {{ header }}
    {% endfor %}
    {% if directory.geoip_enable|default(false) %}
    GeoIPEnable {{ directory.geoip_enable }}
    {% endif %}
    {% if directory.options|default(false) %}
    Options {{ directory.options|join(' ') }}
    {% endif %}
    {% if provider == 'Directory' %}
      {% if directory.index_options|default(false) %}
    IndexOptions {{ directory.index_options|join(' ') }}
      {% endif %}
      {% if directory.index_order_default|default(false) %}
    IndexOrderDefault {{ directory.index_order_default|join(' ') }}
      {% endif %}
      {% if directory.index_style_sheet|default(false) %}
    IndexStyleSheet {{ directory.index_style_sheet|join(' ') }}
      {% endif %}
      {% if directory.allow_override|default(false) %}
    AllowOverride {{ directory.allow_override|join(' ') }}
      {% else %}
    AllowOverride None
      {% endif %}
    {% endif %}
    {% set item = directory %}
    {% include 'apache/require.j2' %}
    {% for __, lim in (directory.limit|default({})).iteritems() %}
    <Limit {{ lim.methods }}>
      {% set item = lim %}
      {% include 'apache/require.j2' %}
    </Limit>
    {% endfor %}
    {% for addhandler in directory.addhandlers|default([]) %}
    <FilesMatch ".+({{ addhandler.extensions|map('regex_escape')|join('|') }})$">
      SetHandler {{ addhandler.handler }}
    </FilesMatch>
    {% endfor %}
    {% if directory.sethandler|default(false) %}
    SetHandler {{ directory.sethandler }}
    {% endif %}
    {% if directory.passenger_enabled|default(false) %}
    PassengerEnabled {{ directory.passenger_enabled }}
    {% endif %}
    {% for flag, value in directory.php_flags|default({})|dictsort %}
      {% if value|string in ['true', 'True', '1'] %}{% set v = 'on' %}{% else %}{% set v = 'off' %}{% endif %}
    php_flag {{ flag }} {{ v }}
    {% endfor %}
    {% for key, value in directory.php_values|default({})|dictsort %}
    php_value {{ key }} {{ value }}
    {% endfor %}
    {% for flag, value in directory.php_admin_flags|default({})|dictsort %}
      {% if value|string in ['true', 'True', '1'] %}{% set v = 'on' %}{% else %}{% set v = 'off' %}{% endif %}
    php_admin_flag {{ flag }} {{ v }}
    {% endfor %}
    {% for key, value in directory.php_admin_values|default({})|dictsort %}
    php_admin_value {{ key }} {{ value }}
    {% endfor %}
    {% if directory.directoryindex|default(false) %}
    DirectoryIndex {{ directory.directoryindex }}
    {% endif %}
    {% for additional_include in directory.additional_includes|default([]) %}
    Include "{{ additional_include }}"
    {% endfor %}
    {% for error_document in directory.error_documents|default([]) %}
    ErrorDocument {{ error_document.error_code }} {{ error_document.document }}
    {% endfor %}
    {% if directory.dav|default(false) %}
    Dav {{ directory.dav }}
      {% if directory.dav_depth_infinity|default(false) %}
        {% set v = directory.dav_depth_infinity %}
        {% if v|string in ['true', 'True', '1', 1] %}
          {% set v = 'On' %}
        {% elif v|string in ['false', 'False', '0', 0] %}
          {% set v = 'Off' %}
        {% endif %}
    DavDepthInfinity {{ v }}
      {% endif %}
      {% if directory.dav_min_timeout|default(false) %}
    DavMinTimeout {{ directory.dav_min_timeout }}
      {% endif %}
    {% endif %}
    {% if directory.auth_type|default(false) %}
    AuthType {{ directory.auth_type }}
    {% endif %}
    {% if directory.auth_name|default(false) %}
    AuthName {{ directory.auth_name }}
    {% endif %}
    {% if directory.auth_digest_algorithm|default(false) %}
    AuthDigestAlgorithm {{ directory.auth_digest_algorithm }}
    {% endif %}
    {% if directory.auth_digest_domain|default(false) %}
    AuthDigestDomain {{ directory.auth_digest_domain }}
    {% endif %}
    {% if directory.auth_digest_nonce_lifetime|default(false) %}
    AuthDigestNonceLifetime {{ directory.auth_digest_nonce_lifetime }}
    {% endif %}
    {% if directory.auth_digest_provider|default(false) %}
    AuthDigestProvider {{ directory.auth_digest_provider }}
    {% endif %}
    {% if directory.auth_digest_qop|default(false) %}
    AuthDigestQop {{ directory.auth_digest_qop }}
    {% endif %}
    {% if directory.auth_digest_shmem_size|default(false) %}
    AuthDigestShmemSize {{ directory.auth_digest_shmem_size }}
    {% endif %}
    {% if directory.auth_basic_authoritative|default(false) %}
    AuthBasicAuthoritative {{ directory.auth_basic_authoritative }}
    {% endif %}
    {% if directory.auth_basic_fake|default(false) %}
    AuthBasicFake {{ directory.auth_basic_fake }}
    {% endif %}
    {% if directory.auth_basic_provider|default(false) %}
    AuthBasicProvider {{ directory.auth_basic_provider }}
    {% endif %}
    {% if directory.auth_user_file|default(false) %}
    AuthUserFile {{ directory.auth_user_file }}
    {% endif %}
    {% if directory.auth_group_file|default(false) %}
    AuthGroupFile {{ directory.auth_group_file }}
    {% endif %}
    {% if directory.auth_merging|default(false) %}
    AuthMerging {{ directory.auth_merging }}
    {% endif %}
    {% if directory.auth_ldap_url|default(false) %}
    AuthLDAPURL {{ directory.auth_ldap_url }}
    {% endif %}
    {% if directory.auth_ldap_bind_dn|default(false) %}
    AuthLDAPBindDN {{ directory.auth_ldap_bind_dn }}
    {% endif %}
    {% if directory.auth_ldap_bind_password|default(false) %}
    AuthLDAPBindPassword {{ directory.auth_ldap_bind_password }}
    {% endif %}
    {% for groupattr in directory.auth_ldap_group_attribute|default([]) %}
    AuthLDAPGroupAttribute {{ groupattr }}
    {% endfor %}
    {% if directory.auth_ldap_group_attribute_is_dn|default(false) == 'off' %}
    AuthLDAPGroupAttributeIsDN Off
    {% endif %}
    {% if directory.auth_ldap_group_attribute_is_dn|default(false) == 'on' %}
    AuthLDAPGroupAttributeIsDN On
    {% endif %}
    {% if directory.fallbackresource|default(false) %}
    FallbackResource {{ directory.fallbackresource }}
    {% endif %}
    {% if directory.expires_active|default(false) %}
    ExpiresActive {{ directory.expires_active }}
    {% endif %}
    {% if directory.expires_default|default(false) %}
    ExpiresDefault {{ directory.expires_default }}
    {% endif %}
    {% for rule in directory.expires_by_type|default([]) %}
    ExpiresByType {{ rule }}
    {% endfor %}

    {% if directory.ext_filter_options|default(false) %}
    ExtFilterOptions {{ directory.ext_filter_options }}
    {% endif %}
    {% if directory.force_type|default(false) %}
    ForceType {{ directory.force_type }}
    {% endif %}
    {% if directory.ssl_options|default([]) %}
    SSLOptions {{ directory.ssl_options|join(' ') }}
    {% endif %}
    {% if directory.suphp|default({}) %}
    suPHP_UserGroup {{ directory.suphp.user }} {{ directory.suphp.group }}
    {% endif %}
    {% if directory.fcgiwrapper|default({}) %}
    FcgidWrapper {{ directory.fcgiwrapper.command }} {{ directory.fcgiwrapper.suffix }} {{ directory.fcgiwrapper.virtual }}
    {% endif %}
    {% if directory.rewrites|default({}) %}
    # Rewrite rules
    RewriteEngine On
      {% for rewrite_details in directory.rewrites|default([]) %}
        {% if rewrite_details.comment|default(false) %}
    #{{ rewrite_details.comment }}
        {% endif %}
        {% if rewrite_details.rewrite_base|default(false) %}
    RewriteBase {{ rewrite_details.rewrite_base }}
        {% endif %}
        {% for command in rewrite_details.rewrite_cond|default([]) %}
    RewriteCond {{ command }}
        {% endfor %}
        {% for command in rewrite_details.rewrite_rule|default([]) %}
    RewriteRule {{ command }}
        {% endfor %}
      {% endfor %}
    {% endif %}
    {% for setenv in directory.setenv|default([]) %}
    SetEnv {{ setenv }}
    {% endfor %}
    {% if directory.set_output_filter|default(false) %}
    SetOutputFilter {{ directory.set_output_filter }}
    {% endif %}
    {% if directory.shib_require_session|default(false) %}
    ShibRequireSession {{ directory.shib_require_session }}
    {% endif %}
    {% for shibKey, shibValue in directory.shib_request_settings|default({}) %}
    ShibRequestSetting {{ shibKey }} {{ shibValue }}
    {% endfor %}
    {% if directory.shib_use_headers|default(false) %}
    ShibUseHeaders {{ directory.shib_use_headers }}
    {% endif %}
    {% if directory.cas_scope|default(false) %}
    CASScope {{ directory.cas_scope }}
    {% endif %}
    {% if directory.cas_renew|default(false) %}
    CASRenew {{ directory.cas_renew }}
    {% endif %}
    {% if directory.cas_gateway|default(false) %}
    CASGateway {{ directory.cas_gateway }}
    {% endif %}
    {% if directory.cas_cookie|default(false) %}
    CASCookie {{ directory.cas_cookie }}
    {% endif %}
    {% if directory.cas_secure_cookie|default(false) %}
    CASSecureCookie {{ directory.cas_secure_cookie }}
    {% endif %}
    {% if directory.cas_gateway_cookie|default(false) %}
    CASGatewayCookie {{ directory.cas_gateway_cookie }}
    {% endif %}
    {% if directory.cas_authn_header|default(false) %}
    CASAuthNHeader {{ directory.cas_authn_header }}
    {% endif %}
    {% if directory.mellon_enable|default(false) %}
    MellonEnable "{{ directory.mellon_enable }}"
      {% if directory.mellon_endpoint_path|default(false) %}
    MellonEndpointPath "{{ directory.mellon_endpoint_path }}"
      {% endif %}
      {% if directory.mellon_sp_private_key_file|default(false) %}
    MellonSPPrivateKeyFile "{{ directory.mellon_sp_private_key_file }}"
      {% endif %}
      {% if directory.mellon_sp_cert_file|default(false) %}
    MellonSPCertFile "{{ directory.mellon_sp_cert_file }}"
      {% endif %}
      {% if directory.mellon_sp_metadata_file|default(false) %}
    MellonSPMetadataFile "{{ directory.mellon_sp_metadata_file }}"
      {% endif %}
      {% if directory.mellon_idp_metadata_file|default(false) %}
    MellonIDPMetadataFile "{{ directory.mellon_idp_metadata_file }}"
      {% endif %}
      {% for envKey, envValue in directory.mellon_set_env_no_prefix|default({}) %}
    MellonSetEnvNoPrefix "{{ envKey }}" "{{ envValue }}"
      {% endfor %}
      {% if directory.mellon_user|default(false) %}
    MellonUser "{{ directory.mellon_user }}"
      {% endif %}
      {% if directory.mellon_saml_response_dump|default(false) %}
    MellonSamlResponseDump "{{ directory.mellon_saml_response_dump }}"
      {% endif %}
      {% for cond in directory.mellon_cond|default([]) %}
    MellonCond {{ cond }}
      {% endfor %}
    {% endif %}
    {% if directory.custom_fragment|default(false) %}
    {{ directory.custom_fragment }}
    {% endif %}
  </{{ provider}}>
  {% endif %}
{% endfor %}
